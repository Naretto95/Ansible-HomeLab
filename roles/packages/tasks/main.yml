---

- name: Validate packages_state and repos_state
  assert:
    that:
      - packages_state in ['present', 'absent']
      - repos_state in ['present', 'absent']
    fail_msg: "packages_state and repos_state can only be 'present' or 'absent'."

- name: Install Python with raw module
  raw: |
    apt-get update -y
    apt-get install -y python3 python3-apt
  when: os_family in ["Debian", "Proxmox"]
  changed_when: false

- name: Gather host facts
  ansible.builtin.setup:
    gather_subset:
        - distribution_release

- name: Setup repositories
  include_tasks: repositories/setup_repositories.yml

- name: Install packages
  include_tasks: packages/install_packages.yml
  when: packages_state == 'present'

- name: Remove packages
  include_tasks: packages/remove_packages.yml
  when: packages_state == 'absent'